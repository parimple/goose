name: Build Goose Release Candidate

on:
  pull_request:

jobs:
  bundle-desktop:
    if: startsWith(github.head_ref, 'release/')
    uses: ./.github/workflows/bundle-desktop.yml

  comment-on-pr:
    needs: bundle-desktop
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - name: Comment with download link
        uses: peter-evans/create-or-update-comment@71345be0265236311c031f5c7866368bd1eff043 # pin@v4
        with:
          issue-number: ${{ github.event.number }}
          body: |
            ### macOS ARM64 Desktop App (Apple Silicon)

            [ðŸ“± Download macOS Desktop App (arm64, signed)](${{ needs.bundle-desktop.outputs.artifact-url }})

            **Instructions:**
            After downloading, unzip the file and drag the Goose.app to your Applications folder. The app is signed and notarized for macOS.
